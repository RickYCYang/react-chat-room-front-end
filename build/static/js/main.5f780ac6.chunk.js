(this["webpackJsonpreact-chat-room-front-end"]=this["webpackJsonpreact-chat-room-front-end"]||[]).push([[0],{100:function(e,t){},103:function(e,t,n){},107:function(e,t,n){e.exports=n.p+"static/media/chat.36cb8b4b.png"},108:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(30),o=n.n(r),l=(n(71),n(5)),s=n(20),u=n(13),i=n(17),m=n(14),d=n(60),p=n(65),E=n(11),b={account:"",password:"",status:"",email:"",error:"",userName:""},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER_ACCOUNT":return Object(E.a)({},e,{account:t.payload});case"SET_USER_PASSWORD":return Object(E.a)({},e,{password:t.payload});case"LOGIN_REQUEST":return Object(E.a)({},e,{status:"loading"});case"LOGIN_SUCCESS":return Object(E.a)({},e,{status:"logined",email:t.payload.email,token:t.payload.token,userName:t.payload.userName});case"LOGIN_FAIL":return Object(E.a)({},e,{status:"error",message:t.payload.message});default:return e}},g={messageBox:[],webSocket:"",onlineCount:0,connectStatus:""},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CONNECT_WEB_SOCKET":return Object(E.a)({},e,{connectStatus:"connecting"});case"CONNECT_WEB_SOCKET_SUCCESS":return Object(E.a)({},e,{connectStatus:"connected",webSocket:t.payload});case"CONNECT_WEB_SOCKET_FAIL":return Object(E.a)({},e,{connectStatus:"disconnect",webSocket:t.payload});case"SET_ONLINE_COUNT":return Object(E.a)({},e,{onlineCount:t.payload});case"SET_MESSAGE_BOX":return Object(E.a)({},e,{messageBox:e.messageBox.concat([t.payload])});default:return e}},S=function(e){return Object(m.c)({router:Object(u.b)(e),loginReducer:f,chatRoomReducer:O})},C=n(10),h=n.n(C),v=n(15),w=n(8),N=n(32),j=n.n(N),k="https://express-chat-room-back-end.herokuapp.com",y=_("token");function _(e){return j.a.get(e)}var x=function(e,t){j.a.set(e,t,{expires:7})},T=function(e){j.a.remove(e)},R=h.a.mark(I);function I(e){var t,n,a,c;return h.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,n=t.account,a=t.password,r.next=3,o={email:n,password:a},fetch(k+"/"+"login",{method:"POST",headers:{"Access-Control-Allow-Origin":"http://localhost:3001",Accept:"application/json","content-type":"application/json",Authorization:y},dataType:"jsonp",credentials:"include",body:JSON.stringify(o)}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log("fetchPost",e)}));case 3:if("fail"!==(c=r.sent).status){r.next=10;break}return console.log("Fail:",c),r.next=8,Object(v.a)({type:"LOGIN_FAIL",payload:{message:c.message}});case 8:r.next=20;break;case 10:if("success"!==c.status){r.next=20;break}return console.log("success:",c),r.next=14,Object(v.a)({type:"LOGIN_SUCCESS",payload:{token:c.token,email:c.email,userName:c.userName}});case 14:return r.next=16,x("token",c.token);case 16:return r.next=18,x("userName",c.userName);case 18:return r.next=20,Object(v.a)(Object(w.d)("/"));case 20:case"end":return r.stop()}var o}),R)}var B=n(63),A=n.n(B),L=h.a.mark(U);function U(e){var t;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("connectWebSocket",e),n.next=3,A()(k);case 3:if(!(t=n.sent)){n.next=9;break}return n.next=7,Object(v.a)({type:"CONNECT_WEB_SOCKET_SUCCESS",payload:t});case 7:n.next=11;break;case 9:return n.next=11,Object(v.a)({type:"CONNECT_WEB_SOCKET_FAIL"});case 11:case"end":return n.stop()}}),L)}var W=h.a.mark(P);function P(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(v.b)("LOGIN_REQUEST",I);case 2:return e.next=4,Object(v.b)("CONNECT_WEB_SOCKET",U);case 4:case"end":return e.stop()}}),W)}var G=Object(i.a)(),F=Object(p.a)();n(103);var K=n(64),M=n(7),D=n(24),J=n.n(D),Q=n(27),X=n.n(Q),q=n(21),z=n.n(q),H=n(9),V=n.n(H),$={setAccountPassword:function(e){var t=e.currentTarget,n=t.id,a=t.value;switch(n){case"account":return{type:"SET_USER_ACCOUNT",payload:a};case"password":return{type:"SET_USER_PASSWORD",payload:a}}},login:function(e,t){return{type:"LOGIN_REQUEST",payload:{account:e,password:t}}},checkLogined:function(){var e=_("token");return console.log("checkLogined",void 0!==e),e?Object(w.d)("/"):{type:null}}},Y=Object(l.c)((function(e){return{account:e.loginReducer.account,password:e.loginReducer.password,status:e.loginReducer.status,message:e.loginReducer.message}}),$)((function(e){var t=e.account,r=e.password,o=e.status,l=e.message,s=e.setAccountPassword,u=e.login,i=e.checkLogined;Object(a.useEffect)((function(){i()}),[]);var m=function(){var e=Object(K.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=3;break}return alert("Please enter your account"),e.abrupt("return");case 3:if(t.includes("@")){e.next=6;break}return alert("Illegal email address format"),e.abrupt("return");case 6:if(""!==r){e.next=9;break}return alert("Please enter your password"),e.abrupt("return");case 9:u(t,r);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement(M.Grid,null,c.a.createElement(M.Row,null,c.a.createElement(M.Cell,{columns:3}),c.a.createElement(M.Cell,{columns:6},c.a.createElement(J.a,{id:"loginCard"},c.a.createElement(D.CardPrimaryContent,{id:"tittle"},c.a.createElement("h1",null,"Rick's Chat Room: Beta"),c.a.createElement(D.CardMedia,{id:"logoImg",square:!0,imageUrl:n(107)})),c.a.createElement(D.CardActions,{style:{display:"block"}},c.a.createElement(D.CardActionButtons,{id:"textFieldArea"},c.a.createElement(z.a,{label:"Email",className:"textField",trailingIcon:c.a.createElement(V.a,{role:"button",icon:"delete"})},c.a.createElement(q.Input,{id:"account",type:"email",value:t,onChange:s})),c.a.createElement(z.a,{label:"Password",className:"textField",trailingIcon:c.a.createElement(V.a,{role:"button",icon:"delete"})},c.a.createElement(q.Input,{id:"password",type:"password",value:r,onChange:s})),c.a.createElement("div",null,c.a.createElement(X.a,{className:"loginBtn",outlined:!0,raised:!0,icon:c.a.createElement(V.a,{role:"button",icon:"login"}),onClick:m},"Login"),c.a.createElement(X.a,{className:"loginBtn",outlined:!0,raised:!0,disabled:!0,icon:c.a.createElement(V.a,{role:"button",icon:"account_box"}),onClick:m},"Signup")))),"error"===o?c.a.createElement("div",null,c.a.createElement("p",{className:"warnMsg"},l)):[])),c.a.createElement(M.Cell,{columns:3})))})),Z=n(19),ee=n.n(Z),te=function(){var e,t=Object(l.e)((function(e){return e.chatRoomReducer})).messageBox,n=_("userName");return Object(a.useEffect)((function(){e.scrollIntoView({behavior:"smooth"})})),c.a.createElement("div",{id:"messagePanel-bg"},c.a.createElement("div",{id:"messagePanel"},t.map((function(e){return c.a.createElement(M.Row,{key:"row"+e.userName+e.timestamp},c.a.createElement(M.Cell,{columns:12},c.a.createElement("div",{className:n===e.useName?"messageBox_mine":"messageBox_other"},c.a.createElement(V.a,{role:"button",icon:"account_circle",className:"account_icon"}),c.a.createElement("span",null,e.useName,"(",e.timestamp,")"),c.a.createElement("div",{className:n===e.useName?"message_mine":"message_other"},e.message))))})),c.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e=t}})))},ne=n(44),ae=function(){var e=Object(a.useState)(""),t=Object(ne.a)(e,2),n=t[0],r=t[1],o=Object(l.e)((function(e){return e.chatRoomReducer})).webSocket,s=Object(a.useState)(!1),u=Object(ne.a)(s,2),i=u[0],m=u[1],d=_("userName");Object(a.useEffect)((function(){i&&(p(),m(!1))}));var p=function(){var e=(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+":"+(new Date).getUTCMilliseconds();console.log("sendMessage",n),o.emit("send",{useName:d,message:n,timestamp:e}),r("")},E=function(e){"Enter"===e.key&&m(!0)};return Object(a.useEffect)((function(){return o&&document.addEventListener("keypress",E),function(){document.removeEventListener("keypress",E)}}),[o]),c.a.createElement("div",{id:"messageSender"},c.a.createElement(z.a,{label:"\u4f60\u60f3\u8aaa\u4ec0\u9ebc",id:"msgTextEdit",onTrailingIconSelect:function(){return r("")},trailingIcon:c.a.createElement(V.a,{role:"button",icon:"delete"})},c.a.createElement(q.Input,{id:"msgTextEditInput",value:n,onChange:function(e){var t=e.currentTarget.value;r(t)}})),c.a.createElement("div",{className:"wrapper-div"},c.a.createElement(X.a,{id:"msgSendBtn",outlined:!0,raised:!0,icon:c.a.createElement(V.a,{role:"button",icon:"send"}),onClick:p},"Send")))},ce={connectWebSocket:function(){return{type:"CONNECT_WEB_SOCKET"}},setOnlineCount:function(e){return{type:"SET_ONLINE_COUNT",payload:e}}},re=Object(l.c)((function(e){return{webSocket:e.chatRoomReducer.webSocket,onlineCount:e.chatRoomReducer.onlineCount}}),ce)((function(e){var t=e.webSocket,n=(e.onlineCount,e.connectWebSocket),r=e.setOnlineCount,o=Object(l.d)();Object(a.useEffect)((function(){t?s():n()}),[t]);var s=function(){console.log("initWebSocket"),t.on("online",(function(e){r(e)})),t.on("msg",(function(e){console.log("message",e),o({type:"SET_MESSAGE_BOX",payload:e})}))};return c.a.createElement(M.Grid,{id:"mainGrid"},c.a.createElement(M.Row,null,c.a.createElement(M.Cell,{columns:12},c.a.createElement(te,null))),c.a.createElement(M.Row,null,c.a.createElement(M.Cell,{columns:12},c.a.createElement(ae,null))))})),oe=function(){var e=Object(l.d)(),t=(Object(l.e)((function(e){return e.loginReducer})).status,Object(l.e)((function(e){return e.chatRoomReducer})).onlineCount),n=_("token"),r=_("userName");Object(a.useEffect)((function(){n||e(Object(w.d)("/login"))}),[n]);return Object(a.useEffect)((function(){})),c.a.createElement(c.a.Fragment,null,n?c.a.createElement(c.a.Fragment,null,c.a.createElement(ee.a,null,c.a.createElement(Z.TopAppBarRow,null,c.a.createElement(Z.TopAppBarSection,{align:"start"},c.a.createElement(Z.TopAppBarIcon,{navIcon:!0,tabIndex:0},c.a.createElement(V.a,{hasRipple:!0,icon:"menu",onClick:function(){return console.log("click")}})),c.a.createElement(Z.TopAppBarTitle,null,"Welcome ",r,", Online People: ",t)),c.a.createElement(Z.TopAppBarSection,{align:"end",role:"toolbar"},c.a.createElement(Z.TopAppBarIcon,{actionItem:!0,tabIndex:0},c.a.createElement(V.a,{"aria-label":"print page",hasRipple:!0,icon:"exit_to_app",onClick:function(){console.log("logout"),T("token"),T("userName"),e(Object(w.d)("/login"))}}))))),c.a.createElement(Z.TopAppBarFixedAdjust,null,c.a.createElement(re,null))):[])},le=function(e){var t=Object(m.e)(S(G),e,Object(m.d)(Object(m.a)(Object(d.a)(G),F)));return F.run(P),t}(),se=function(){return c.a.createElement(l.a,{store:le},c.a.createElement(u.a,{history:G},c.a.createElement(s.c,null,c.a.createElement(s.a,{exact:!0,path:"/"},c.a.createElement(oe,null)),c.a.createElement(s.a,{exact:!0,path:"/login"},c.a.createElement(Y,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(se,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},66:function(e,t,n){e.exports=n(108)},71:function(e,t,n){}},[[66,1,2]]]);
//# sourceMappingURL=main.5f780ac6.chunk.js.map